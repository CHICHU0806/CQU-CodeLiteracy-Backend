<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>è¯¾ç¨‹å­¦ä¹ ä¸å­¦é£å»ºè®¾ - äº¤äº’å¢å¼ºç‰ˆ</title>
    <style>
        body { margin: 0; height: 100vh; background-color: #eee; font-family: sans-serif; }
        .shadow { box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
        .flex { display: flex; }
        .baiSe { background-color: white; }
        .flex1 { flex: 1; }
        .column { flex-direction: column; }
        .mg8 { margin: 8px; }
        .mgr8 { margin-right: 8px; }
        .mgt8 { margin-top: 8px; }

        /* åˆ—è¡¨é¡¹æ ·å¼ä¼˜åŒ– */
        .list-item {
            height: 160px;
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: transform 0.2s; /* æ·»åŠ å¹³æ»‘ä½ç§»æ•ˆæœ */
        }
        .list-item:hover {
            transform: translateY(-3px); /* é¼ æ ‡æ‚¬åœå¾®åŠ¨ */
        }

        /* å¼¹çª—é®ç½©å±‚æ ·å¼ */
        #myModal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(2px); /* èƒŒæ™¯æ¨¡ç³Šæ„Ÿ */
        }
        /* å¼¹çª—ä¸»ä½“æ ·å¼ */
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            width: 400px;
            border-radius: 12px;
            text-align: center;
            position: relative;
        }

        @media (max-width:600px) {
            .ceBian { display: none; }
            .neiRong, .shuJuQu { flex-direction: column; }
            .youQu { margin-left: 8px; }
            .shuJu { margin: 0 0 8px; flex: auto; }
        }
    </style>
</head>
<body class="flex">

<div id="myModal">
    <div class="modal-content shadow">
        <h2 id="modal-title" style="margin-top: 0; color: #333;">è¯¾ç¨‹è¯¦æƒ…</h2>
        <p id="modal-desc" style="color: #666; line-height: 1.6; margin-bottom: 25px;"></p>
        <div class="flex" style="justify-content: center; gap: 15px;">
            <button onclick="closeModal()" style="padding: 10px 20px; background-color: #ccc; border: none; border-radius: 6px; cursor: pointer;">å–æ¶ˆ</button>
            <button onclick="handleEnroll()" style="padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">ç«‹å³æŠ¥å</button>
        </div>
    </div>
</div>

<div style="width: 200px;height: 100vh;position: fixed;z-index: 2" class="baiSe shadow">
    <div style="padding: 10px;align-items: center;justify-content: center;border-bottom: 1px solid #999" class="flex">
        <img id="user-avatar" src="ç”µåŠ›æ¶‰ç½‘è®¾å¤‡.png" width="40px" height="40px" alt="å¤´åƒ" style="border-radius: 50%">
        <div id="user-name" style="margin-left: 10px; font-weight: bold;">æ­£åœ¨åŠ è½½...</div>
    </div>
    <div style="padding: 10px" class="flex column">
        <div style="height: 40px;line-height: 40px;text-align: center;border-bottom: 1px solid #999;margin-bottom: 10px;">é¦–é¡µ</div>
        <div style="height: 40px;line-height: 40px;text-align: center;border-bottom: 1px solid #999;margin-bottom: 10px;">è¯¾ç¨‹å­¦ä¹ </div>
        <div style="height: 40px;line-height: 40px;text-align: center;border-bottom: 1px solid #999;margin-bottom: 10px;">å­¦é£å»ºè®¾</div>
        <div style="height: 40px;line-height: 40px;text-align: center;border-bottom: 1px solid #999;margin-bottom: 10px;">ä¸ªäººä¸­å¿ƒ</div>
    </div>
</div>

<div style="margin-left: 200px" class="flex1 column">
    <div style="height: 60px;z-index: 1" class="baiSe shadow flex; align-items: center; padding: 0 20px;">
        <h3 style="line-height: 60px; margin: 0 20px;">ç³»ç»Ÿç®¡ç†åå°</h3>
    </div>

    <div style="overflow: auto" class="neiRong flex1 flex">
        <div style="flex: 3" class="flex column mg8">
            <div class="flex shuJuQu" id="stats-container">
                <div style="height: 100px; padding: 10px;" class="shuJu flex1 baiSe shadow mgr8">ç»Ÿè®¡1: --</div>
                <div id="stat-enroll" style="height: 100px; padding: 10px;" class="shuJu flex1 baiSe shadow mgr8">æŠ¥åæ€»äººæ•°: 0</div>
            </div>

            <div class="flex column" id="course-list">
                <div class="baiSe shadow mgt8 list-item">æ­£åœ¨ä» Java åç«¯è·å–åˆ—è¡¨...</div>
            </div>
        </div>

        <div style="flex: 1" class="youQu flex column mgr8 mgt8">
            <div style="height: 150px; padding: 15px;" class="baiSe shadow">å…¬å‘Šæ </div>
            <div style="height: 300px; padding: 15px;" class="baiSe shadow mgt8">æœ€è¿‘æ¶ˆæ¯</div>
        </div>
    </div>
</div>

<script>
    // å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè®°å½•å½“å‰é€‰ä¸­çš„è¯¾ç¨‹ï¼Œæ–¹ä¾¿æŠ¥åæ—¶ä½¿ç”¨
    let currentSelectedCourse = null;

    // --- å¼¹çª—æ§åˆ¶é€»è¾‘ ---
    function openModal(title, desc) {
        currentSelectedCourse = title; // è®°å½•æ ‡é¢˜
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-desc').innerText = desc;
        document.getElementById('myModal').style.display = "block";
    }

    function closeModal() {
        document.getElementById('myModal').style.display = "none";
    }

    function handleEnroll() {
        fetch('http://localhost:8080/api/courses/enroll', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title: currentSelectedCourse })
        })
            .then(res => res.json()) // ğŸ‘ˆ æ³¨æ„ï¼šç°åœ¨åç«¯è¿”å›çš„æ˜¯ JSON å¯¹è±¡ï¼Œæ‰€ä»¥ç”¨ .json()
            .then(result => {
                // 1. æ›´æ–°ç½‘é¡µé¡¶éƒ¨çš„æ•°å­—
                document.getElementById('stat-enroll').innerText = "æŠ¥åæ€»æ•°: " + result.newCount;

                // 2. æç¤ºç”¨æˆ·
                alert(result.message);
                closeModal();
            })
            .catch(err => console.error("æŠ¥åå¤±è´¥:", err));
    }

    // --- æ•°æ®åŠ è½½é€»è¾‘ ---
    window.onload = function() {
        // 1. è·å–ç”¨æˆ·ä¿¡æ¯
        fetch('http://localhost:8080/api/user/info')
            .then(res => res.json())
            .then(data => {
                document.getElementById('user-name').innerText = data.name;
            })
            .catch(err => {
                console.error("ç”¨æˆ·ä¿¡æ¯å¯¹æ¥å¤±è´¥:", err);
                document.getElementById('user-name').innerText = "åç«¯æœªè¿æ¥";
            });

        // 2. è·å–è¯¾ç¨‹åˆ—è¡¨
        fetch('http://localhost:8080/api/courses')
            .then(res => res.json())
            .then(list => {
                const container = document.getElementById('course-list');
                container.innerHTML = '';

                list.forEach(course => {
                    const card = document.createElement('div');
                    card.className = "baiSe shadow mgt8 list-item";
                    card.style.cursor = "pointer";

                    card.innerHTML = `
                        <h4 style="margin: 0 0 10px 0; color: #333;">${course.title}</h4>
                        <p style="margin: 0; color: #666; font-size: 14px;">${course.description}</p>
                    `;

                    // ç‚¹å‡»å¡ç‰‡ï¼Œä¸å†å¼¹å‡º alertï¼Œè€Œæ˜¯è°ƒç”¨ openModal
                    card.onclick = function() {
                        openModal(course.title, course.description);
                    };

                    container.appendChild(card);
                });
            })
            .catch(err => {
                console.error("è¯¾ç¨‹åŠ è½½å¤±è´¥:", err);
                document.getElementById('course-list').innerHTML = "æ— æ³•åŠ è½½è¯¾ç¨‹åˆ—è¡¨ï¼Œè¯·æ£€æŸ¥åç«¯ã€‚";
            });
    };
</script>
</body>
</html>